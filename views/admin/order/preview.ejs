<!DOCTYPE html>
<html lang="en" class="light-style layout-menu-fixed" dir="ltr" data-theme="theme-default"
  data-assets-path="../public/admin/assets/" data-template="vertical-menu-template-free">

<head>
  <%- include('../partials/head') -%>
  <%- include('../partials/common-list-css') -%>
  <%- include('../partials/common-crud-css') -%>
</head>

<body>
  <!-- Layout wrapper -->
  <div class="layout-wrapper layout-content-navbar">
    <div class="layout-container">
      <%- include('../partials/navbar-left') -%>
      <!-- Layout container -->
      <div class="layout-page">
        <%- include('../partials/navbar-top') -%>
        <!-- Content wrapper -->
        <div class="content-wrapper">

          <!-- Content -->

          <div class="container-xxl flex-grow-1 container-p-y">

            <%if(typeof data !="undefined" && data != null){%>

            <div class="row invoice-preview">
              <!-- Invoice -->
              <div class="col-xl-12 col-md-12 col-12 mb-md-0 mb-4">
                <div class="card invoice-preview-card">
                  <div class="card-body">
                    <div
                      class="d-flex justify-content-between flex-xl-row flex-md-column flex-sm-row flex-column p-sm-3 p-0">
                      <% if(data.customerId || data.billingAddress){%>
                      <div class="mb-xl-0 mb-4">
                        <div class="d-flex svg-illustration mb-3 gap-2">
                          <% if(data.customerId){ %>
                          <a href="">#<%= data.customerId%></a>
                          <% } else {%>
                          <span
                            class="app-brand-text demo text-body fw-bolder"><%= data.billingAddress.fullname %></span>
                          <% }%>
                        </div>
                        <p class="mb-1"><%= data.billingAddress.address %></p>
                        <p class="mb-1"><%= data.billingAddress.phone %></p>
                        <p class="mb-0"><%= data.billingAddress.email %></p>
                      </div>
                      <%}%>
                            <div>
                              <h4>Order : #<%= data._id%></h4>
                      <div class="mb-2">
                        <span class="me-1">Ngày tạo :</span>
                        <span class="fw-semibold"><%= new Date(data.createdAt).toLocaleDateString('vi-VN');%></span>
                      </div>
                    </div>
                  </div>
                </div>
                <hr class="my-0">
                <div class="table-responsive">
                  <% if(data.products && data.products.length > 0){%>
                  <table class="table border-top m-0">
                    <thead>
                      <tr>
                        <th>Sản phẩm</th>
                        <%if(data.products[0].categoryId){%>
                        <th>Loại</th>
                        <%}%>
                                <%if(data.products[0].adult){%>
                        <th>Người lớn</th>
                        <%}%>
                                <%if(data.products[0].children){%>
                        <th>Trẻ em</th>
                        <%}%>
                                <%if(data.products[0].timeStart){%>
                        <th>Thời gian checkin</th>
                        <%}%>
                                <%if(data.products[0].timeEnd){%>
                        <th>Thời gian checkout</th>
                        <%}%>
                                <%if(data.products[0].size){%>
                        <th>Size</th>
                        <%}%>
                                <%if(data.products[0].color){%>
                        <th>Màu</th>
                        <%}%>
                                <%if(data.products[0].measures){%>
                        <th>Số đo</th>
                        <%}%>
                                <%if(data.products[0].weight){%>
                        <th>Cân nặng</th>
                        <%}%>
                                <%if(data.products[0].height){%>
                        <th>Chiều cao</th>
                        <%}%>
                                <%if(data.products[0].width){%>
                        <th>Chiều rộng</th>
                        <%}%>
                                <th>Số Lượng</th>
                                <th>Giá</th>
                              </tr>
                            </thead>
                            <tbody>
                              <%  data.products.forEach(function(item, index){ %>
                      <tr>
                        <td>
                          <% if(data.productList){
                                     let product = data.productList.find(x=>x._id == item.productId)
                                      if(product){%>
                          <%= product.name%>
                          <%}else{ %>
                          <%= item.productId %>
                          <%}}else{%>
                          <%= item.productId %>
                          <%} %>
                        </td>
                        <%if(item.categoryId){%>
                        <td>
                          <% if(data.categoryList){
                                    let category = data.categoryList.find(x=>x._id == item.categoryId)%>
                          <% if(category){%>
                          <%= category.name%>
                          <%}else{ %>
                          <%= item.categoryId %>
                          <%}}else{%>
                          <%= item.categoryId %>
                          <%} %>
                        </td>
                        <%}%>
                                <%if(item.adult){%>
                        <td><%= item.adult%></td>
                        <%}%>
                                <%if(item.children){%>
                        <td><%= item.children%></td>
                        <%}%>
                                <%if(item.timeStart){%>
                        <td><%= item.timeStart%></td>
                        <%}%>
                                <%if(item.timeEnd){%>
                        <td><%= item.timeEnd%></td>
                        <%}%>
                                <%if(item.size){%>
                        <td><%= item.size%></td>
                        <%}%>
                                <%if(item.color){%>
                        <td><%= item.color%></td>
                        <%}%>
                                <%if(item.measures){%>
                        <td><%= item.measures%></td>
                        <%}%>
                                <%if(item.weight){%>
                        <td><%= item.weight%></td>
                        <%}%>
                                <%if(item.height){%>
                        <td><%= item.height%></td>
                        <%}%>
                                <%if(item.width){%>
                        <td><%= item.width%></td>
                        <%}%>
                                <td><%= item.quantity%></td>
                        <td>
                          <%= item.price.trim()%>
                        </td>
                      </tr>
                      <%} )%>
                      </tbody>
                  </table>
                  <%}%>
                        </div>
                        <div class="card-body">
                          <div class="row p-sm-1 p-0">
                            <div class="col-xl-8 col-md-12 col-sm-5 col-12 mb-xl-0 mb-md-4 mb-sm-0 mb-4">
                              </div>
                            <div class="col-xl-4 col-md-12 col-sm-5 col-12 mb-xl-0 mb-md-4 mb-sm-0 mb-4">
                              <%  
                              var subTotal = 0
                              var shipFee = 0
                              var discount = 0
                             /* if (data.products && data.productList) {
                                data.products.forEach(function (item) {
                                  let product = data.productList.find(x=>x._id == item.productId)
                                  if (product) {
                                    if (typeof product.ecommercePlus !="undefined" && product.ecommercePlus != null){
                                      var ecommercePlus = product.ecommercePlus.find(x=>x.atribute.some(s=>s.code == item.color))
                                      if (!ecommercePlus && product.ecommercePlus.length > 0) {
                                        ecommercePlus = product.ecommercePlus[0]
                                      }
                                      subTotal = subTotal + item.quantity * ecommercePlus.price
                                    }else {
                                      if (product.ecommerce.priceSale) {
                                        subTotal = subTotal + item.quantity * product.ecommerce.priceSale
                                      }else{
                                        subTotal = subTotal + item.quantity * product.ecommerce.price
                                      }
                                    }
                                  }
                                });
                              } */
                              if(data.subTotal && data.subTotal){
                                subTotal = data.subTotal
                              }
                              if(data.discount && data.discount.discount){
                                discount = data.discount.discount
                              }
                              if(data.ship && data.ship.price){
                                shipFee = data.ship.price
                              }
                              %>
                  <table>
                    <tr>
                      <td colspan="1" class="align-top px-4 py-5">
                      </td>
                      <td class="text-end px-4 py-5">
                        <p class="mb-2">Thành tiền:</p>
                        <p class="mb-2">Phí ship:</p>
                        <p class="mb-2">Giảm giá:</p>
                        <p class="mb-2">Thuế:</p>
                        <p class="mb-0">Tổng:</p>
                      </td>
                      <td class="px-4 py-5">
                        <p class="fw-semibold mb-2">
                          <%= new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(subTotal) %>
                        </p>
                        <p class="fw-semibold mb-2">
                          <%= new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(shipFee) %>
                        </p>
                        <p class="fw-semibold mb-2">
                          <%= new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(discount) %>
                        </p>
                        <p class="fw-semibold mb-2">--</p>
                        <p class="fw-semibold mb-0">
                          <%= new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(parseInt(subTotal) + parseInt(shipFee) - parseInt(discount))%>
                        </p>
                      </td>
                    </tr>
                  </table>
                </div>
              </div>
            </div>
            <hr class="my-0">
            <div class="card-body">
              <div class="row p-sm-3 p-0">
                <div class="col-xl-6 col-md-12 col-sm-5 col-12 mb-xl-0 mb-md-4 mb-sm-0 mb-4">
                  <h6 class="pb-2">Địa chỉ gửi hàng:</h6>
                  <% if(data.shippingAddress){%>
                  <table>
                    <tbody>
                      <tr>
                        <td class="pe-3">Tên:</td>
                        <td>
                          <p class="mb-1"><%= data.shippingAddress.fullname %></p>
                        </td>
                      </tr>
                      <tr>
                        <td class="pe-3">Mã code :</td>
                        <td>
                          <p class="mb-1"><%= data.shippingAddress.code %></p>
                        </td>
                      </tr>
                      <tr>
                        <td class="pe-3">Địa chỉ : </td>
                        <td>
                          <p class="mb-1"><%= data.shippingAddress.address %></p>
                        </td>
                      </tr>
                      <tr>
                        <td class="pe-3">Số điện thoại : </td>
                        <td>
                          <p class="mb-1"><%= data.shippingAddress.phone %></p>
                        </td>
                      </tr>
                      <tr>
                        <td class="pe-3">Email : </td>
                        <td>
                          <p class="mb-1"><%= data.shippingAddress.email %></p>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                  <% } else 
                              if (data.billingAddress){ %>
                  <table>
                    <tbody>
                      <tr>
                        <td class="pe-3">Tên:</td>
                        <td>
                          <p class="mb-1"><%= data.billingAddress.fullname %></p>
                        </td>
                      </tr>
                      <tr>
                        <td class="pe-3">Địa chỉ : </td>
                        <td>
                          <p class="mb-1"><%= data.billingAddress.address %></p>
                        </td>
                      </tr>
                      <tr>
                        <td class="pe-3">Số điện thoại : </td>
                        <td>
                          <p class="mb-1"><%= data.billingAddress.phone %></p>
                        </td>
                      </tr>
                      <tr>
                        <td class="pe-3">Email : </td>
                        <td>
                          <p class="mb-1"><%= data.billingAddress.email %></p>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                  <%}%>
                            </div>
                            <div class="col-xl-6 col-md-12 col-sm-5 col-12 mb-xl-0 mb-md-4 mb-sm-0 mb-4">
                              <h6 class="pb-2">Phương thức thanh toán:</h6>
                              <% if(data.paymend){ %>
                  <h5 class="pb-2"><%= data.paymend.name %></h5>
                  <% } %>
                </div>
              </div>
            </div>
            <hr class="my-0">
            <div class="card-body">
              <div class="row">
                <div class="col-12">
                  <span class="fw-semibold">Mô tả : </span>
                  <span><%= data.note%></span>
                </div>
              </div>
            </div>
            <hr class="my-0">
            <div class="card-body">
              <div class="row">
                <div class="col-12">
                  <% if (data.customFields && data.customFields.length > 0) {%>
                  <%  data.customFields.forEach(function (item) {%>
                  <h6 class="pb-2"><%= item.displayName%></h6>
                  <table>
                    <tbody>
                      <%   if (item.fields && item.fields.length > 0) {%>
                      <%    item.fields.forEach(function (field) {%>
                        <tr>
                          <td class="pe-3"><%=field.name%> :</td>
                          <td>
                            <% if (field.typeField == "IMAGE") {%>
                              <p class="mb-1"><img style="width: 120px; height: 120px" src="../<%= field.value %>"/></p>
                            <% } else if (field.typeField == "LINK") { %>  
                              <p class="mb-1"><a href="<%= field.value %>"><%= field.value %></a></p>
                            <% } else { %>
                              <p class="mb-1"><%= field.value %></p>
                            <% }  %>
                          </td>
                        </tr>
                      <%  }) %>
                      <% } %>
                    </tbody>
                  </table>
                  <%  })%>
                  <%}%>
                </div>
              </div>
            </div>

          </div>
        </div>
        <!-- /Invoice -->

        <!-- Invoice Actions -->
        <!-- <div class="col-xl-3 col-md-4 col-12 invoice-actions">
                      <div class="card">
                        <div class="card-body">
                          <button class="btn btn-primary d-grid w-100 mb-3" data-bs-toggle="offcanvas" data-bs-target="#sendInvoiceOffcanvas">
                            <span class="d-flex align-items-center justify-content-center text-nowrap"><i class="bx bx-paper-plane bx-xs me-1"></i>Send Invoice</span>
                          </button>
                          <button class="btn btn-label-secondary d-grid w-100 mb-3">
                            Download
                          </button>
                          <a class="btn btn-label-secondary d-grid w-100 mb-3" target="_blank" href="./app-invoice-print.html">
                            Print
                          </a>
                          <a href="./app-invoice-edit.html" class="btn btn-label-secondary d-grid w-100 mb-3">
                            Edit Invoice
                          </a>
                          <button class="btn btn-primary d-grid w-100" data-bs-toggle="offcanvas" data-bs-target="#addPaymentOffcanvas">
                            <span class="d-flex align-items-center justify-content-center text-nowrap"><i class="bx bx-dollar bx-xs me-1"></i>Add Payment</span>
                          </button>
                        </div>
                      </div>
                    </div> -->
        <!-- /Invoice Actions -->
      </div>
      <%}%>
                  <!-- Offcanvas -->
                  <!-- Send Invoice Sidebar -->
                  <div class="offcanvas offcanvas-end" id="sendInvoiceOffcanvas" aria-hidden="true">
                    <div class="offcanvas-header mb-3">
                      <h5 class="offcanvas-title">Send Invoice</h5>
                      <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas"
                        aria-label="Close"></button>
                    </div>
                    <div class="offcanvas-body flex-grow-1">
                      <form>
                        <div class="mb-3">
                          <label for="invoice-from" class="form-label">From</label>
                          <input type="text" class="form-control" id="invoice-from" value="shelbyComapny@email.com"
                            placeholder="company@email.com">
                        </div>
                        <div class="mb-3">
                          <label for="invoice-to" class="form-label">To</label>
                          <input type="text" class="form-control" id="invoice-to" value="qConsolidated@email.com"
                            placeholder="company@email.com">
                        </div>
                        <div class="mb-3">
                          <label for="invoice-subject" class="form-label">Subject</label>
                          <input type="text" class="form-control" id="invoice-subject"
                            value="Invoice of purchased Admin Templates" placeholder="Invoice regarding goods">
                        </div>
                        <div class="mb-3">
                          <label for="invoice-message" class="form-label">Message</label>
                          <textarea class="form-control" name="invoice-message" id="invoice-message" cols="3" rows="8">Dear Queen Consolidated,
                Thank you for your business, always a pleasure to work with you!
                We have generated a new invoice in the amount of $95.59
                We would appreciate payment of this invoice by 05/11/2021</textarea>
                        </div>
                        <div class="mb-4">
                          <span class="badge bg-label-primary">
                            <i class="bx bx-link bx-xs"></i>
                            <span class="align-middle">Invoice Attached</span>
                          </span>
                        </div>
                        <div class="mb-3 d-flex flex-wrap">
                          <button type="button" class="btn btn-primary me-3" data-bs-dismiss="offcanvas">Send</button>
                          <button type="button" class="btn btn-label-secondary"
                            data-bs-dismiss="offcanvas">Cancel</button>
                        </div>
                      </form>
                    </div>
                  </div>
                  <!-- /Send Invoice Sidebar -->

                  <!-- Add Payment Sidebar -->
                  <div class="offcanvas offcanvas-end" id="addPaymentOffcanvas" aria-hidden="true">
                    <div class="offcanvas-header mb-3">
                      <h5 class="offcanvas-title">Add Payment</h5>
                      <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas"
                        aria-label="Close"></button>
                    </div>
                    <div class="offcanvas-body flex-grow-1">
                      <div class="d-flex justify-content-between bg-lighter p-2 mb-3">
                        <p class="mb-0">Invoice Balance:</p>
                        <p class="fw-bold mb-0">$5000.00</p>
                      </div>
                      <form>
                        <div class="mb-3">
                          <label class="form-label" for="invoiceAmount">Payment Amount</label>
                          <div class="input-group">
                            <span class="input-group-text">$</span>
                            <input type="text" id="invoiceAmount" name="invoiceAmount"
                              class="form-control invoice-amount" placeholder="100">
                          </div>
                        </div>
                        <div class="mb-3">
                          <label class="form-label" for="payment-date">Payment Date</label>
                          <input id="payment-date" class="form-control invoice-date flatpickr-input" type="text"
                            readonly="readonly">
                        </div>
                        <div class="mb-3">
                          <label class="form-label" for="payment-method">Payment Method</label>
                          <select class="form-select" id="payment-method">
                            <option value="" selected="" disabled="">Select payment method</option>
                            <option value="Cash">Cash</option>
                            <option value="Bank Transfer">Bank Transfer</option>
                            <option value="Debit Card">Debit Card</option>
                            <option value="Credit Card">Credit Card</option>
                            <option value="Paypal">Paypal</option>
                          </select>
                        </div>
                        <div class="mb-4">
                          <label class="form-label" for="payment-note">Internal Payment Note</label>
                          <textarea class="form-control" id="payment-note" rows="2"></textarea>
                        </div>
                        <div class="mb-3 d-flex flex-wrap">
                          <button type="button" class="btn btn-primary me-3" data-bs-dismiss="offcanvas">Send</button>
                          <button type="button" class="btn btn-label-secondary"
                            data-bs-dismiss="offcanvas">Cancel</button>
                        </div>
                      </form>
                    </div>
                  </div>
                  <!-- /Add Payment Sidebar -->

                  <!-- /Offcanvas -->
                </div>
                <!-- / Content -->

                <%- include('../partials/footer') -%>
                <!-- / Footer -->
                <div class="content-backdrop fade"></div>
              </div>
              <!-- Content wrapper -->
            </div>
            <!-- / Layout page -->
          </div>
          <!-- Overlay -->
          <div class="layout-overlay layout-menu-toggle"></div>
        </div>
        <!-- / Layout wrapper -->
        <%- include('../partials/common-js') -%>
        <%- include('../partials/common-crud-js') -%>
        <%- include('../partials/common-list-js') -%>
        <script src="../public/admin/assets/js/pages/order/preview.js"></script>
</body>

</html>